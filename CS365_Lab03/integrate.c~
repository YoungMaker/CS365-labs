#include <stdio.h>
#include <math.h>
#include <mpi.h>
#include <unistd.h> 

double f(double x);

int main(int argc, char **argv)
{
	MPI_Init(&argc, &argv);

	int rank, size;
	MPI_Comm_rank(MPI_COMM_WORLD, &rank);
	MPI_Comm_size(MPI_COMM_WORLD, &size);

	double xmin, xmax;
	int nrects;

	if (rank == 0) {
		printf("xmin: ");
		fflush(stdout);
		scanf("%lf", &xmin);
	
		printf("xmax: ");
		fflush(stdout);
		scanf("%lf", &xmax);
	
		printf("nrects: ");
		fflush(stdout);
		scanf("%i", &nrects);
	}

	// Broadcast input values
	MPI_Bcast(&xmin, 1, MPI_DOUBLE, 0, MPI_COMM_WORLD); //broadcast min/max
	MPI_Bcast(&xmax, 1, MPI_DOUBLE, 0, MPI_COMM_WORLD);
	
	MPI_Bcast(&nrects, 1, MPI_DOUBLE, 0, MPI_COMM_WORLD); //broadcast nrects

	// Divide up work
	int group_size = nrects/size; // size of rectangle group
	int start = rank*group_size; //start of local rectangle group 
	if(rank == (size-1)) {
		group_size += group_size % size;
	}
	int end = start + group_size; 

	usleep((rank*100));
	printf("proc %i, comp_start %i, comp_end %i]n", rank, start, end);
	fflush(stdout);

	// Local computation
	// TODO

	// Reduce local partial results to produce one global result
	// TODO

	// Print the global result (process 0 only)
	

	MPI_Finalize();

	return 0;
}

double f(double x) {
	return (sin(x) + (pow(x, 1.3)*cos(x)) + (x*log(x)));
}
